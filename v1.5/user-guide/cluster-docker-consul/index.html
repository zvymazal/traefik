



<!DOCTYPE html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
        <meta name="description" content="Træfik Documentation">
      
      
      
        <meta name="author" content="containo.us">
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../../img/traefik.icon.png">
      <meta name="generator" content="mkdocs-0.17.5, mkdocs-material-2.9.4">
    
    
      
        <title>Traefik cluster example with Swarm - Træfik</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/application.451f80e5.css">
      
        <link rel="stylesheet" href="../../assets/stylesheets/application-palette.22915126.css">
      
      
        
        
        <meta name="theme-color" content="#00bcd4">
      
    
    
      <script src="../../assets/javascripts/modernizr.1aa3b519.js"></script>
    
    
      <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
      
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../../assets/fonts/material-icons.css">
    
      <link rel="stylesheet" href="../../theme/styles/extra.css">
    
      <link rel="stylesheet" href="../../theme/styles/atom-one-light.css">
    
    
  </head>
  
    
    
    <body dir="ltr" data-md-color-primary="cyan" data-md-color-accent="cyan">
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448"
    viewBox="0 0 416 448" id="__github">
  <path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19-18.125
        8.5-18.125-8.5-10.75-19-3.125-20.5 3.125-20.5 10.75-19 18.125-8.5
        18.125 8.5 10.75 19 3.125 20.5zM320 304q0 10-3.125 20.5t-10.75
        19-18.125 8.5-18.125-8.5-10.75-19-3.125-20.5 3.125-20.5 10.75-19
        18.125-8.5 18.125 8.5 10.75 19 3.125 20.5zM360
        304q0-30-17.25-51t-46.75-21q-10.25 0-48.75 5.25-17.75 2.75-39.25
        2.75t-39.25-2.75q-38-5.25-48.75-5.25-29.5 0-46.75 21t-17.25 51q0 22 8
        38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0
        37.25-1.75t35-7.375 30.5-15 20.25-25.75 8-38.375zM416 260q0 51.75-15.25
        82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5-41.75
        1.125q-19.5 0-35.5-0.75t-36.875-3.125-38.125-7.5-34.25-12.875-30.25-20.25-21.5-28.75q-15.5-30.75-15.5-82.75
        0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25
        30.875q36.75-8.75 77.25-8.75 37 0 70 8 26.25-20.5
        46.75-30.25t47.25-9.75q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34
        99.5z" />
</svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#clustering-high-availability-on-docker-swarm-with-consul" tabindex="1" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="../.." title="Træfik" class="md-header-nav__button md-logo">
          
            <img src="../../img/traefik.logo.png" width="24" height="24">
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            
              <span class="md-header-nav__topic">
                Træfik
              </span>
              <span class="md-header-nav__topic">
                Traefik cluster example with Swarm
              </span>
            
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          
            <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
            
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
          
        
      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            


  


  <a href="https://github.com/containous/traefik/" title="Go to repository" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#__github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      GitHub
    </div>
  </a>

          </div>
        </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="../.." title="Træfik" class="md-nav__button md-logo">
      
        <img src="../../img/traefik.logo.png" width="48" height="48">
      
    </a>
    Træfik
  </label>
  
    <div class="md-nav__source">
      


  


  <a href="https://github.com/containous/traefik/" title="Go to repository" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#__github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      GitHub
    </div>
  </a>

    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../.." title="Getting Started" class="md-nav__link">
      Getting Started
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../basics/" title="Basics" class="md-nav__link">
      Basics
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3">
    
    <label class="md-nav__link" for="nav-3">
      Configuration
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        Configuration
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../configuration/commons/" title="Commons" class="md-nav__link">
      Commons
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../configuration/entrypoints/" title="EntryPoints" class="md-nav__link">
      EntryPoints
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../configuration/acme/" title="Let's Encrypt" class="md-nav__link">
      Let's Encrypt
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../configuration/backends/web/" title="Backend: Web" class="md-nav__link">
      Backend: Web
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../configuration/backends/boltdb/" title="Backend: BoltDB" class="md-nav__link">
      Backend: BoltDB
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../configuration/backends/consul/" title="Backend: Consul" class="md-nav__link">
      Backend: Consul
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../configuration/backends/consulcatalog/" title="Backend: Consul Catalog" class="md-nav__link">
      Backend: Consul Catalog
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../configuration/backends/docker/" title="Backend: Docker" class="md-nav__link">
      Backend: Docker
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../configuration/backends/dynamodb/" title="Backend: DynamoDB" class="md-nav__link">
      Backend: DynamoDB
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../configuration/backends/ecs/" title="Backend: ECS" class="md-nav__link">
      Backend: ECS
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../configuration/backends/etcd/" title="Backend: Etcd" class="md-nav__link">
      Backend: Etcd
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../configuration/backends/eureka/" title="Backend: Eureka" class="md-nav__link">
      Backend: Eureka
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../configuration/backends/file/" title="Backend: File" class="md-nav__link">
      Backend: File
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../configuration/backends/kubernetes/" title="Backend: Kubernetes Ingress" class="md-nav__link">
      Backend: Kubernetes Ingress
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../configuration/backends/marathon/" title="Backend: Marathon" class="md-nav__link">
      Backend: Marathon
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../configuration/backends/mesos/" title="Backend: Mesos" class="md-nav__link">
      Backend: Mesos
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../configuration/backends/rancher/" title="Backend: Rancher" class="md-nav__link">
      Backend: Rancher
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../configuration/backends/rest/" title="Backend: Rest" class="md-nav__link">
      Backend: Rest
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../configuration/backends/servicefabric/" title="Backend: Azure Service Fabric" class="md-nav__link">
      Backend: Azure Service Fabric
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../configuration/backends/zookeeper/" title="Backend: Zookeeper" class="md-nav__link">
      Backend: Zookeeper
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../configuration/api/" title="API / Dashboard" class="md-nav__link">
      API / Dashboard
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../configuration/ping/" title="Ping" class="md-nav__link">
      Ping
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../configuration/metrics/" title="Metrics" class="md-nav__link">
      Metrics
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4" checked>
    
    <label class="md-nav__link" for="nav-4">
      User Guides
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        User Guides
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../examples/" title="Configuration Examples" class="md-nav__link">
      Configuration Examples
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../swarm-mode/" title="Swarm Mode Cluster" class="md-nav__link">
      Swarm Mode Cluster
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../swarm/" title="Swarm Cluster" class="md-nav__link">
      Swarm Cluster
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../docker-and-lets-encrypt/" title="Let's Encrypt & Docker" class="md-nav__link">
      Let's Encrypt & Docker
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../kubernetes/" title="Kubernetes" class="md-nav__link">
      Kubernetes
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../marathon/" title="Marathon" class="md-nav__link">
      Marathon
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../kv-config/" title="Key-value Store Configuration" class="md-nav__link">
      Key-value Store Configuration
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../cluster/" title="Clustering/HA" class="md-nav__link">
      Clustering/HA
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../grpc/" title="gRPC Example" class="md-nav__link">
      gRPC Example
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Traefik cluster example with Swarm
      </label>
    
    <a href="./" title="Traefik cluster example with Swarm" class="md-nav__link md-nav__link--active">
      Traefik cluster example with Swarm
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#prerequisites" title="Prerequisites" class="md-nav__link">
    Prerequisites
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#trfik-configuration" title="Træfik configuration" class="md-nav__link">
    Træfik configuration
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#entrypoints-configuration" title="EntryPoints configuration" class="md-nav__link">
    EntryPoints configuration
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#lets-encrypt-configuration" title="Let's Encrypt configuration" class="md-nav__link">
    Let's Encrypt configuration
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#docker-configuration" title="Docker configuration" class="md-nav__link">
    Docker configuration
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#full-docker-compose-file" title="Full docker-compose file" class="md-nav__link">
    Full docker-compose file
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#migrate-configuration-to-consul" title="Migrate configuration to Consul" class="md-nav__link">
    Migrate configuration to Consul
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deploy-a-trfik-cluster" title="Deploy a Træfik cluster" class="md-nav__link">
    Deploy a Træfik cluster
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#full-docker-compose-file_1" title="Full docker-compose file" class="md-nav__link">
    Full docker-compose file
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../benchmarks/" title="Benchmarks" class="md-nav__link">
      Benchmarks
    </a>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#prerequisites" title="Prerequisites" class="md-nav__link">
    Prerequisites
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#trfik-configuration" title="Træfik configuration" class="md-nav__link">
    Træfik configuration
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#entrypoints-configuration" title="EntryPoints configuration" class="md-nav__link">
    EntryPoints configuration
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#lets-encrypt-configuration" title="Let's Encrypt configuration" class="md-nav__link">
    Let's Encrypt configuration
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#docker-configuration" title="Docker configuration" class="md-nav__link">
    Docker configuration
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#full-docker-compose-file" title="Full docker-compose file" class="md-nav__link">
    Full docker-compose file
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#migrate-configuration-to-consul" title="Migrate configuration to Consul" class="md-nav__link">
    Migrate configuration to Consul
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deploy-a-trfik-cluster" title="Deploy a Træfik cluster" class="md-nav__link">
    Deploy a Træfik cluster
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#full-docker-compose-file_1" title="Full docker-compose file" class="md-nav__link">
    Full docker-compose file
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/containous/traefik/edit/v1.5/docs/user-guide/cluster-docker-consul.md" title="Edit this page" class="md-icon md-content__icon">&#xE3C9;</a>
                
                
                <h1 id="clustering-high-availability-on-docker-swarm-with-consul">Clustering / High Availability on Docker Swarm with Consul<a class="headerlink" href="#clustering-high-availability-on-docker-swarm-with-consul" title="Permanent link">&para;</a></h1>
<p>This guide explains how to use Træfik in high availability mode in a Docker Swarm and with Let's Encrypt.</p>
<p>Why do we need Træfik in cluster mode? Running multiple instances should work out of the box?</p>
<p>If you want to use Let's Encrypt with Træfik, sharing configuration or TLS certificates between many Træfik instances, you need Træfik cluster/HA.</p>
<p>Ok, could we mount a shared volume used by all my instances? Yes, you can, but it will not work.
When you use Let's Encrypt, you need to store certificates, but not only.
When Træfik generates a new certificate, it configures a challenge and once Let's Encrypt will verify the ownership of the domain, it will ping back the challenge.
If the challenge is not knowing by other Træfik instances, the validation will fail.</p>
<p>For more information about challenge: <a href="https://github.com/ietf-wg-acme/acme/blob/master/draft-ietf-acme-acme.md#tls-with-server-name-indication-tls-sni">Automatic Certificate Management Environment (ACME)</a></p>
<h2 id="prerequisites">Prerequisites<a class="headerlink" href="#prerequisites" title="Permanent link">&para;</a></h2>
<p>You will need a working Docker Swarm cluster.</p>
<h2 id="trfik-configuration">Træfik configuration<a class="headerlink" href="#trfik-configuration" title="Permanent link">&para;</a></h2>
<p>In this guide, we will not use a TOML configuration file, but only command line flag.
With that, we can use the base image without mounting configuration file or building custom image.</p>
<p>What Træfik should do:</p>
<ul>
<li>Listen to 80 and 443</li>
<li>Redirect HTTP traffic to HTTPS</li>
<li>Generate SSL certificate when a domain is added</li>
<li>Listen to Docker Swarm event</li>
</ul>
<h3 id="entrypoints-configuration">EntryPoints configuration<a class="headerlink" href="#entrypoints-configuration" title="Permanent link">&para;</a></h3>
<p>TL;DR:</p>
<pre><code class="shell">$ traefik \
    --entrypoints='Name:http Address::80 Redirect.EntryPoint:https' \
    --entrypoints='Name:https Address::443 TLS' \
    --defaultentrypoints=http,https
</code></pre>

<p>To listen to different ports, we need to create an entry point for each.</p>
<p>The CLI syntax is <code>--entrypoints='Name:a_name Address:an_ip_or_empty:a_port options'</code>.
If you want to redirect traffic from one entry point to another, it's the option <code>Redirect.EntryPoint:entrypoint_name</code>.</p>
<p>By default, we don't want to configure all our services to listen on http and https, we add a default entry point configuration: <code>--defaultentrypoints=http,https</code>.</p>
<h3 id="lets-encrypt-configuration">Let's Encrypt configuration<a class="headerlink" href="#lets-encrypt-configuration" title="Permanent link">&para;</a></h3>
<p>TL;DR:</p>
<pre><code class="shell">$ traefik \
    --acme \
    --acme.storage=/etc/traefik/acme/acme.json \
    --acme.entryPoint=https \
    --acme.httpChallenge.entryPoint=http \
    --acme.email=contact@mydomain.ca
</code></pre>

<p>Let's Encrypt needs 4 parameters: an TLS entry point to listen to, a non-TLS entry point to allow HTTP challenges, a storage for certificates, and an email for the registration.</p>
<p>To enable Let's Encrypt support, you need to add <code>--acme</code> flag.</p>
<p>Now, Træfik needs to know where to store the certificates, we can choose between a key in a Key-Value store, or a file path: <code>--acme.storage=my/key</code> or <code>--acme.storage=/path/to/acme.json</code>.</p>
<p>The <code>acme.httpChallenge.entryPoint</code> flag enables the <code>HTTP-01</code> challenge and specifies the entryPoint to use during the challenges.</p>
<p>For your email and the entry point, it's <code>--acme.entryPoint</code> and <code>--acme.email</code> flags.</p>
<h3 id="docker-configuration">Docker configuration<a class="headerlink" href="#docker-configuration" title="Permanent link">&para;</a></h3>
<p>TL;DR:</p>
<pre><code class="shell">$ traefik \
    --docker \
    --docker.swarmmode \
    --docker.domain=mydomain.ca \
    --docker.watch
</code></pre>

<p>To enable docker and swarm-mode support, you need to add <code>--docker</code> and <code>--docker.swarmmode</code> flags.
To watch docker events, add <code>--docker.watch</code>.</p>
<h3 id="full-docker-compose-file">Full docker-compose file<a class="headerlink" href="#full-docker-compose-file" title="Permanent link">&para;</a></h3>
<pre><code class="yaml">version: &quot;3&quot;
services:
  traefik:
    image: traefik:1.5
    command:
      - &quot;--api&quot;
      - &quot;--entrypoints=Name:http Address::80 Redirect.EntryPoint:https&quot;
      - &quot;--entrypoints=Name:https Address::443 TLS&quot;
      - &quot;--defaultentrypoints=http,https&quot;
      - &quot;--acme&quot;
      - &quot;--acme.storage=/etc/traefik/acme/acme.json&quot;
      - &quot;--acme.entryPoint=https&quot;
      - &quot;--acme.httpChallenge.entryPoint=http&quot;
      - &quot;--acme.OnHostRule=true&quot;
      - &quot;--acme.onDemand=false&quot;
      - &quot;--acme.email=contact@mydomain.ca&quot;
      - &quot;--docker&quot;
      - &quot;--docker.swarmmode&quot;
      - &quot;--docker.domain=mydomain.ca&quot;
      - &quot;--docker.watch&quot;
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock
    networks:
      - webgateway
      - traefik
    ports:
      - target: 80
        published: 80
        mode: host
      - target: 443
        published: 443
        mode: host
      - target: 8080
        published: 8080
        mode: host
    deploy:
      mode: global
      placement:
        constraints:
          - node.role == manager
      update_config:
        parallelism: 1
        delay: 10s
      restart_policy:
        condition: on-failure
networks:
  webgateway:
    driver: overlay
    external: true
  traefik:
    driver: overlay
</code></pre>

<h2 id="migrate-configuration-to-consul">Migrate configuration to Consul<a class="headerlink" href="#migrate-configuration-to-consul" title="Permanent link">&para;</a></h2>
<p>We created a special Træfik command to help configuring your Key Value store from a Træfik TOML configuration file and/or CLI flags.</p>
<h2 id="deploy-a-trfik-cluster">Deploy a Træfik cluster<a class="headerlink" href="#deploy-a-trfik-cluster" title="Permanent link">&para;</a></h2>
<p>The best way we found is to have an initializer service.
This service will push the config to Consul via the <code>storeconfig</code> sub-command.</p>
<p>This service will retry until finishing without error because Consul may not be ready when the service tries to push the configuration.</p>
<p>The initializer in a docker-compose file will be:</p>
<pre><code class="yaml">  traefik_init:
    image: traefik:1.5
    command:
      - &quot;storeconfig&quot;
      - &quot;--api&quot;
      [...]
      - &quot;--consul&quot;
      - &quot;--consul.endpoint=consul:8500&quot;
      - &quot;--consul.prefix=traefik&quot;
    networks:
      - traefik
    deploy:
      restart_policy:
        condition: on-failure
    depends_on:
      - consul
</code></pre>

<p>And now, the Træfik part will only have the Consul configuration.</p>
<pre><code class="yaml">  traefik:
    image: traefik:1.5
    depends_on:
      - traefik_init
      - consul
    command:
      - &quot;--consul&quot;
      - &quot;--consul.endpoint=consul:8500&quot;
      - &quot;--consul.prefix=traefik&quot;
    [...]
</code></pre>

<div class="admonition note">
<p class="admonition-title">Note</p>
<p>For Træfik &lt;1.5.0 add <code>acme.storage=traefik/acme/account</code> because Træfik is not reading it from Consul.</p>
</div>
<p>If you have some update to do, update the initializer service and re-deploy it.
The new configuration will be stored in Consul, and you need to restart the Træfik node: <code>docker service update --force traefik_traefik</code>.</p>
<h2 id="full-docker-compose-file_1">Full docker-compose file<a class="headerlink" href="#full-docker-compose-file_1" title="Permanent link">&para;</a></h2>
<pre><code class="yaml">version: &quot;3.4&quot;
services:
  traefik_init:
    image: traefik:1.5
    command:
      - &quot;storeconfig&quot;
      - &quot;--api&quot;
      - &quot;--entrypoints=Name:http Address::80 Redirect.EntryPoint:https&quot;
      - &quot;--entrypoints=Name:https Address::443 TLS&quot;
      - &quot;--defaultentrypoints=http,https&quot;
      - &quot;--acme&quot;
      - &quot;--acme.storage=traefik/acme/account&quot;
      - &quot;--acme.entryPoint=https&quot;
      - &quot;--acme.httpChallenge.entryPoint=http&quot;
      - &quot;--acme.OnHostRule=true&quot;
      - &quot;--acme.onDemand=false&quot;
      - &quot;--acme.email=foobar@example.com&quot;
      - &quot;--docker&quot;
      - &quot;--docker.swarmmode&quot;
      - &quot;--docker.domain=example.com&quot;
      - &quot;--docker.watch&quot;
      - &quot;--consul&quot;
      - &quot;--consul.endpoint=consul:8500&quot;
      - &quot;--consul.prefix=traefik&quot;
    networks:
      - traefik
    deploy:
      restart_policy:
        condition: on-failure
    depends_on:
      - consul
  traefik:
    image: traefik:1.5
    depends_on:
      - traefik_init
      - consul
    command:
      - &quot;--consul&quot;
      - &quot;--consul.endpoint=consul:8500&quot;
      - &quot;--consul.prefix=traefik&quot;
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock
    networks:
      - webgateway
      - traefik
    ports:
      - target: 80
        published: 80
        mode: host
      - target: 443
        published: 443
        mode: host
      - target: 8080
        published: 8080
        mode: host
    deploy:
      mode: global
      placement:
        constraints:
          - node.role == manager
      update_config:
        parallelism: 1
        delay: 10s
      restart_policy:
        condition: on-failure
  consul:
    image: consul
    command: agent -server -bootstrap-expect=1
    volumes:
      - consul-data:/consul/data
    environment:
      - CONSUL_LOCAL_CONFIG={&quot;datacenter&quot;:&quot;us_east2&quot;,&quot;server&quot;:true}
      - CONSUL_BIND_INTERFACE=eth0
      - CONSUL_CLIENT_INTERFACE=eth0
    deploy:
      replicas: 1
      placement:
        constraints:
          - node.role == manager
      restart_policy:
        condition: on-failure
    networks:
      - traefik

networks:
  webgateway:
    driver: overlay
    external: true
  traefik:
    driver: overlay

volumes:
  consul-data:
      driver: [not local]
</code></pre>
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        <!--
  Copyright (c) 2016-2017 Martin Donath <martin.donath@squidfunk.com>

  Permission is hereby granted, free of charge, to any person obtaining a copy
  of this software and associated documentation files (the "Software"), to
  deal in the Software without restriction, including without limitation the
  rights to use, copy, modify, merge, publish, distribute, sublicense, and/or
  sell copies of the Software, and to permit persons to whom the Software is
  furnished to do so, subject to the following conditions:

  The above copyright notice and this permission notice shall be included in
  all copies or substantial portions of the Software.

  THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
  IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
  FITNESS FOR A PARTICULAR PURPOSE AND NON-INFRINGEMENT. IN NO EVENT SHALL THE
  AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
  LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
  FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS
  IN THE SOFTWARE.
-->



<!-- Application footer -->
<footer class="md-footer">

    <!-- Link to previous and/or next page -->
    
    <!--<div class="md-footer-nav">-->
        <!--<nav class="md-footer-nav__inner md-grid">-->
            <!-- -->
            <!-- Link to previous page -->
            <!---->
            <!--<a href="../grpc/"-->
               <!--title="gRPC Example"-->
               <!--class="md-flex md-footer-nav__link md-footer-nav__link&#45;&#45;prev"-->
               <!--rel="prev">-->
                <!--<div class="md-flex__cell md-flex__cell&#45;&#45;shrink">-->
                    <!--<i class="md-icon md-icon&#45;&#45;arrow-back-->
                    <!--md-footer-nav__button"></i>-->
                <!--</div>-->
                <!--<div class="md-flex__cell md-flex__cell&#45;&#45;stretch-->
                  <!--md-footer-nav__title">-->
              <!--<span class="md-flex__ellipsis">-->
                <!--<span class="md-footer-nav__direction">-->
                  <!--Previous -->
                <!--</span>-->
                <!--gRPC Example-->
              <!--</span>-->
                <!--</div>-->
            <!--</a>-->
            <!---->
            <!-- -->
            <!-- Link to next page -->
            <!---->
            <!--<a href="../../benchmarks/" title="Benchmarks"-->
               <!--class="md-flex md-footer-nav__link md-footer-nav__link&#45;&#45;next"-->
               <!--rel="next">-->
                <!--<div class="md-flex__cell md-flex__cell&#45;&#45;stretch-->
                  <!--md-footer-nav__title">-->
              <!--<span class="md-flex__ellipsis">-->
                <!--<span class="md-footer-nav__direction">-->
                  <!--Next-->
                <!--</span>-->
                <!--Benchmarks-->
              <!--</span>-->
                <!--</div>-->
                <!--<div class="md-flex__cell md-flex__cell&#45;&#45;shrink">-->
                    <!--<i class="md-icon md-icon&#45;&#45;arrow-forward-->
                    <!--md-footer-nav__button"></i>-->
                <!--</div>-->
            <!--</a>-->
            <!---->
        <!--</nav>-->
    <!--</div>-->
    

    <!-- Further information -->
    <div class="md-footer-meta md-typeset">
        <div class="md-footer-meta__inner md-grid">

            <!-- Copyright and theme information -->
            <div class="md-footer-copyright">
                
                <div class="md-footer-copyright__highlight">
                    Copyright &copy; 2016-2018 Containous SAS
                </div>
                
                powered by
                <a href="http://www.mkdocs.org" title="MkDocs">MkDocs</a>
                and
                <a href="http://squidfunk.github.io/mkdocs-material/"
                   title="Material for MkDocs">
                    Material for MkDocs</a>
            </div>

            <!-- Social links -->
            
                
            
        </div>
    </div>
</footer>
      
    </div>
    
      <script src="../../assets/javascripts/application.30f6b8b1.js"></script>
      
      <script>app.initialize({version:"0.17.5",url:{base:"../.."}})</script>
      
        <script src="../../theme/js/hljs/highlight.pack.js"></script>
      
        <script src="../../theme/js/extra.js"></script>
      
        <script src="../../theme/js/structor-menu.js"></script>
      
    
    
      
        <script>!function(e,a,t,n,o,c,i){e.GoogleAnalyticsObject=o,e.ga=e.ga||function(){(e.ga.q=e.ga.q||[]).push(arguments)},e.ga.l=1*new Date,c=a.createElement(t),i=a.getElementsByTagName(t)[0],c.async=1,c.src="https://www.google-analytics.com/analytics.js",i.parentNode.insertBefore(c,i)}(window,document,"script",0,"ga"),ga("create","UA-51880359-3","docs.traefik.io"),ga("set","anonymizeIp",!0),ga("send","pageview");var links=document.getElementsByTagName("a");if(Array.prototype.map.call(links,function(e){e.host!=document.location.host&&e.addEventListener("click",function(){var a=e.getAttribute("data-md-action")||"follow";ga("send","event","outbound",a,e.href)})}),document.forms.search){var query=document.forms.search.query;query.addEventListener("blur",function(){if(this.value){var e=document.location.pathname;ga("send","pageview",e+"?q="+this.value)}})}</script>
      
    
  </body>
</html>