<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        <meta name="author" content="containo.us">
        
        <link rel="shortcut icon" href="img/traefik.icon.png">
        

	<title>Basics - Traefik</title>

        <link href="../css/bootstrap-custom.min.css" rel="stylesheet">
        <link href="../css/font-awesome-4.0.3.css" rel="stylesheet">
        <link rel="stylesheet" href="../css/highlight.css">
        <link href="../css/base.css" rel="stylesheet">
        <link href="../css/traefik.css" rel="stylesheet">

        <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->

        
    </head>

    <body>

        <div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">

        <!-- Collapsed navigation -->
        <div class="navbar-header">
            <!-- Expander button -->
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>

            <!-- Main title -->
            <a class="navbar-brand" href="..">Traefik</a>
        </div>

        <!-- Expanded navigation -->
        <div class="navbar-collapse collapse">
            <!-- Main navigation -->
            <ul class="nav navbar-nav">
            
            
                <li >
                    <a href="..">Getting Started</a>
                </li>
            
            
            
                <li class="active">
                    <a href="./">Basics</a>
                </li>
            
            
            
                <li >
                    <a href="../toml/">traefik.toml</a>
                </li>
            
            
            
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">User Guide <b class="caret"></b></a>
                    <ul class="dropdown-menu">
                    
                        
<li >
    <a href="../user-guide/examples/">Configuration examples</a>
</li>

                    
                        
<li >
    <a href="../user-guide/swarm/">Swarm cluster</a>
</li>

                    
                    </ul>
                </li>
            
            
            
                <li >
                    <a href="../benchmarks/">Benchmarks</a>
                </li>
            
            
            </ul>

            <!-- Search, Navigation and Repo links -->
            <ul class="nav navbar-nav navbar-right">
                <li>
                    <a href="#" data-toggle="modal" data-target="#mkdocs_search_modal">
                        <i class="fa fa-search"></i> Search
                    </a>
                </li>
                <li >
                    <a rel="next" href="..">
                        <i class="fa fa-arrow-left"></i> Previous
                    </a>
                </li>
                <li >
                    <a rel="prev" href="../toml/">
                        Next <i class="fa fa-arrow-right"></i>
                    </a>
                </li>
                
                <li>
                    <a href="https://github.com/containous/traefik">
                        
                            <i class="fa fa-github"></i>
                        
                        GitHub
                    </a>
                </li>
                
            </ul>
        </div>
    </div>
</div>

        <div class="container">
            <div class="col-md-3"><div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
    
        <li class="main active"><a href="#concepts">Concepts</a></li>
        
            <li><a href="#entrypoints">Entrypoints</a></li>
        
            <li><a href="#frontends">Frontends</a></li>
        
            <li><a href="#backends">Backends</a></li>
        
            <li><a href="#servers">Servers</a></li>
        
    
        <li class="main "><a href="#launch">Launch</a></li>
        
    
    </ul>
</div></div>
            <div class="col-md-9" role="main">

<h1 id="concepts">Concepts</h1>
<p>Let's take our example from the <a href="https://docs.traefik.io/#overview">overview</a> again:</p>
<blockquote>
<p>Imagine that you have deployed a bunch of microservices on your infrastructure. You probably used a service registry (like etcd or consul) and/or an orchestrator (swarm, Mesos/Marathon) to manage all these services.
If you want your users to access some of your microservices from the Internet, you will have to use a reverse proxy and configure it using virtual hosts or prefix paths:</p>
<ul>
<li>domain <code>api.domain.com</code> will point the microservice <code>api</code> in your private network</li>
<li>path <code>domain.com/web</code> will point the microservice <code>web</code> in your private network</li>
<li>domain <code>backoffice.domain.com</code> will point the microservices <code>backoffice</code> in your private network, load-balancing between your multiple instances</li>
</ul>
<p><img alt="Architecture" src="../img/architecture.png" /></p>
</blockquote>
<p>Let's zoom on Træfɪk and have an overview of its internal architecture:</p>
<p><img alt="Architecture" src="../img/internal.png" /></p>
<ul>
<li>Incoming requests end on <a href="#entrypoints">entrypoints</a>, as the name suggests, they are the network entry points into Træfɪk (listening port, SSL, traffic redirection...).</li>
<li>Traffic is then forwarded to a matching <a href="#frontends">frontend</a>. A frontend defines routes from <a href="#entrypoints">entrypoints</a> to <a href="#backends">backends</a>.
Routes are created using requests fields (<code>Host</code>, <code>Path</code>, <code>Headers</code>...) and can match or not a request.</li>
<li>The <a href="#frontends">frontend</a> will then send the request to a <a href="#backends">backend</a>. A backend can be composed by one or more <a href="#servers">servers</a>, and by a load-balancing strategy.</li>
<li>Finally, the <a href="#servers">server</a> will forward the request to the corresponding microservice in the private network.</li>
</ul>
<h2 id="entrypoints">Entrypoints</h2>
<p>Entrypoints are the network entry points into Træfɪk.
They can be defined using:</p>
<ul>
<li>a port (80, 443...)</li>
<li>SSL (Certificates. Keys...)</li>
<li>redirection to another entrypoint (redirect <code>HTTP</code> to <code>HTTPS</code>)</li>
</ul>
<p>Here is an example of entrypoints definition:</p>
<pre><code class="toml">[entryPoints]
  [entryPoints.http]
  address = &quot;:80&quot;
    [entryPoints.http.redirect]
    entryPoint = &quot;https&quot;
  [entryPoints.https]
  address = &quot;:443&quot;
    [entryPoints.https.tls]
      [[entryPoints.https.tls.certificates]]
      certFile = &quot;tests/traefik.crt&quot;
      keyFile = &quot;tests/traefik.key&quot;
</code></pre>

<ul>
<li>Two entrypoints are defined <code>http</code> and <code>https</code>.</li>
<li><code>http</code> listens on port <code>80</code> and <code>https</code> on port <code>443</code>.</li>
<li>We enable SSL on <code>https</code> by giving a certificate and a key.</li>
<li>We also redirect all the traffic from entrypoint <code>http</code> to <code>https</code>.</li>
</ul>
<h2 id="frontends">Frontends</h2>
<p>A frontend is a set of rules that forwards the incoming traffic from an entrypoint to a backend.
Frontends can be defined using the following rules:</p>
<ul>
<li><code>Headers: Content-Type, application/json</code>: Headers adds a matcher for request header values. It accepts a sequence of key/value pairs to be matched.</li>
<li><code>HeadersRegexp: Content-Type, application/(text|json)</code>: Regular expressions can be used with headers as well. It accepts a sequence of key/value pairs, where the value has regex support.</li>
<li><code>Host: traefik.io, www.traefik.io</code>: Match request host with given host list.</li>
<li><code>HostRegexp: traefik.io, {subdomain:[a-z]+}.traefik.io</code>: Adds a matcher for the URL hosts. It accepts templates with zero or more URL variables enclosed by <code>{}</code>. Variables can define an optional regexp pattern to be matched.</li>
<li><code>Method: GET, POST, PUT</code>: Method adds a matcher for HTTP methods. It accepts a sequence of one or more methods to be matched.</li>
<li><code>Path: /products/, /articles/{category}/{id:[0-9]+}</code>: Path adds a matcher for the URL paths. It accepts templates with zero or more URL variables enclosed by <code>{}</code>.</li>
<li><code>PathStrip</code>: Same as <code>Path</code> but strip the given prefix from the request URL's Path.</li>
<li><code>PathPrefix</code>: PathPrefix adds a matcher for the URL path prefixes. This matches if the given template is a prefix of the full URL path.</li>
<li><code>PathPrefixStrip</code>: Same as <code>PathPrefix</code> but strip the given prefix from the request URL's Path.</li>
</ul>
<p>You can use multiple rules by separating them by <code>;</code></p>
<p>You can optionally enable <code>passHostHeader</code> to forward client <code>Host</code> header to the backend.</p>
<p>Here is an example of frontends definition:</p>
<pre><code class="toml">[frontends]
  [frontends.frontend1]
  backend = &quot;backend2&quot;
    [frontends.frontend1.routes.test_1]
    rule = &quot;Host:test.localhost,test2.localhost&quot;
  [frontends.frontend2]
  backend = &quot;backend1&quot;
  passHostHeader = true
  priority = 10
  entrypoints = [&quot;https&quot;] # overrides defaultEntryPoints
    [frontends.frontend2.routes.test_1]
    rule = &quot;Host:localhost,{subdomain:[a-z]+}.localhost&quot;
  [frontends.frontend3]
  backend = &quot;backend2&quot;
    [frontends.frontend3.routes.test_1]
    rule = &quot;Host:test3.localhost;Path:/test&quot;
</code></pre>

<ul>
<li>Three frontends are defined: <code>frontend1</code>, <code>frontend2</code> and <code>frontend3</code></li>
<li><code>frontend1</code> will forward the traffic to the <code>backend2</code> if the rule <code>Host:test.localhost,test2.localhost</code> is matched</li>
<li><code>frontend2</code> will forward the traffic to the <code>backend1</code> if the rule <code>Host:localhost,{subdomain:[a-z]+}.localhost</code> is matched (forwarding client <code>Host</code> header to the backend)</li>
<li><code>frontend3</code> will forward the traffic to the <code>backend2</code> if the rules <code>Host:test3.localhost</code> <strong>AND</strong> <code>Path:/test</code> are matched</li>
</ul>
<h3 id="combining-multiple-rules">Combining multiple rules</h3>
<p>As seen in the previous example, you can combine multiple rules.
In TOML file, you can use multiple routes:</p>
<pre><code class="toml">  [frontends.frontend3]
  backend = &quot;backend2&quot;
    [frontends.frontend3.routes.test_1]
    rule = &quot;Host:test3.localhost&quot;
    [frontends.frontend3.routes.test_2]
    rule = &quot;Host:Path:/test&quot;
</code></pre>

<p>Here <code>frontend3</code> will forward the traffic to the <code>backend2</code> if the rules <code>Host:test3.localhost</code> <strong>AND</strong> <code>Path:/test</code> are matched.
You can also use the notation using a <code>;</code> separator, same result:</p>
<pre><code class="toml">  [frontends.frontend3]
  backend = &quot;backend2&quot;
    [frontends.frontend3.routes.test_1]
    rule = &quot;Host:test3.localhost;Path:/test&quot;
</code></pre>

<p>Finally, you can create a rule to bind multiple domains or Path to a frontend, using the <code>,</code> separator:</p>
<pre><code class="toml"> [frontends.frontend2]
    [frontends.frontend2.routes.test_1]
    rule = &quot;Host:test1.localhost,test2.localhost&quot;
  [frontends.frontend3]
  backend = &quot;backend2&quot;
    [frontends.frontend3.routes.test_1]
    rule = &quot;Path:/test1,/test2&quot;
</code></pre>

<h3 id="priorities">Priorities</h3>
<p>By default, routes will be sorted (in descending order) using rules length (to avoid path overlap):
<code>PathPrefix:/12345</code> will be matched before <code>PathPrefix:/1234</code> that will be matched before <code>PathPrefix:/1</code>.</p>
<p>You can customize priority by frontend:</p>
<pre><code>  [frontends]
    [frontends.frontend1]
    backend = &quot;backend1&quot;
    priority = 10
    passHostHeader = true
      [frontends.frontend1.routes.test_1]
      rule = &quot;PathPrefix:/to&quot;
    [frontends.frontend2]
    priority = 5
    backend = &quot;backend2&quot;
    passHostHeader = true
      [frontends.frontend2.routes.test_1]
      rule = &quot;PathPrefix:/toto&quot;
</code></pre>

<p>Here, <code>frontend1</code> will be matched before <code>frontend2</code> (<code>10 &gt; 5</code>).</p>
<h2 id="backends">Backends</h2>
<p>A backend is responsible to load-balance the traffic coming from one or more frontends to a set of http servers.
Various methods of load-balancing is supported:</p>
<ul>
<li><code>wrr</code>: Weighted Round Robin</li>
<li><code>drr</code>: Dynamic Round Robin: increases weights on servers that perform better than others. It also rolls back to original weights if the servers have changed.</li>
</ul>
<p>A circuit breaker can also be applied to a backend, preventing high loads on failing servers.
Initial state is Standby. CB observes the statistics and does not modify the request.
In case if condition matches, CB enters Tripped state, where it responds with predefines code or redirects to another frontend.
Once Tripped timer expires, CB enters Recovering state and resets all stats.
In case if the condition does not match and recovery timer expires, CB enters Standby state.</p>
<p>It can be configured using:</p>
<ul>
<li>Methods: <code>LatencyAtQuantileMS</code>, <code>NetworkErrorRatio</code>, <code>ResponseCodeRatio</code></li>
<li>Operators:  <code>AND</code>, <code>OR</code>, <code>EQ</code>, <code>NEQ</code>, <code>LT</code>, <code>LE</code>, <code>GT</code>, <code>GE</code></li>
</ul>
<p>For example:</p>
<ul>
<li><code>NetworkErrorRatio() &gt; 0.5</code>: watch error ratio over 10 second sliding window for a frontend</li>
<li><code>LatencyAtQuantileMS(50.0) &gt; 50</code>:  watch latency at quantile in milliseconds.</li>
<li><code>ResponseCodeRatio(500, 600, 0, 600) &gt; 0.5</code>: ratio of response codes in range [500-600) to  [0-600)</li>
</ul>
<p>To proactively prevent backends from being overwhelmed with high load, a maximum connection limit can
also be applied to each backend.</p>
<p>Maximum connections can be configured by specifying an integer value for <code>maxconn.amount</code> and
<code>maxconn.extractorfunc</code> which is a strategy used to determine how to categorize requests in order to
evaluate the maximum connections.</p>
<p>For example:</p>
<pre><code class="toml">[backends]
  [backends.backend1]
    [backends.backend1.maxconn]
       amount = 10
       extractorfunc = &quot;request.host&quot;
</code></pre>

<ul>
<li><code>backend1</code> will return <code>HTTP code 429 Too Many Requests</code> if there are already 10 requests in progress for the same Host header.</li>
<li>Another possible value for <code>extractorfunc</code> is <code>client.ip</code> which will categorize requests based on client source ip.</li>
<li>Lastly <code>extractorfunc</code> can take the value of <code>request.header.ANY_HEADER</code> which will categorize requests based on <code>ANY_HEADER</code> that you provide.</li>
</ul>
<h2 id="servers">Servers</h2>
<p>Servers are simply defined using a <code>URL</code>. You can also apply a custom <code>weight</code> to each server (this will be used by load-balancing).</p>
<p>Here is an example of backends and servers definition:</p>
<pre><code class="toml">[backends]
  [backends.backend1]
    [backends.backend1.circuitbreaker]
      expression = &quot;NetworkErrorRatio() &gt; 0.5&quot;
    [backends.backend1.servers.server1]
    url = &quot;http://172.17.0.2:80&quot;
    weight = 10
    [backends.backend1.servers.server2]
    url = &quot;http://172.17.0.3:80&quot;
    weight = 1
  [backends.backend2]
    [backends.backend2.LoadBalancer]
      method = &quot;drr&quot;
    [backends.backend2.servers.server1]
    url = &quot;http://172.17.0.4:80&quot;
    weight = 1
    [backends.backend2.servers.server2]
    url = &quot;http://172.17.0.5:80&quot;
    weight = 2
</code></pre>

<ul>
<li>Two backends are defined: <code>backend1</code> and <code>backend2</code></li>
<li><code>backend1</code> will forward the traffic to two servers: <code>http://172.17.0.2:80"</code> with weight <code>10</code> and <code>http://172.17.0.3:80</code> with weight <code>1</code> using default <code>wrr</code> load-balancing strategy.</li>
<li><code>backend2</code> will forward the traffic to two servers: <code>http://172.17.0.4:80"</code> with weight <code>1</code> and <code>http://172.17.0.5:80</code> with weight <code>2</code> using <code>drr</code> load-balancing strategy.</li>
<li>a circuit breaker is added on <code>backend1</code> using the expression <code>NetworkErrorRatio() &gt; 0.5</code>: watch error ratio over 10 second sliding window</li>
</ul>
<h1 id="launch">Launch</h1>
<p>Træfɪk can be configured using a TOML file configuration, arguments, or both.
By default, Træfɪk will try to find a <code>traefik.toml</code> in the following places:</p>
<ul>
<li><code>/etc/traefik/</code></li>
<li><code>$HOME/.traefik/</code></li>
<li><code>.</code> <em>the working directory</em></li>
</ul>
<p>You can override this by setting a <code>configFile</code> argument:</p>
<pre><code class="bash">$ traefik --configFile=foo/bar/myconfigfile.toml
</code></pre>

<p>Træfɪk uses the following precedence order. Each item takes precedence over the item below it:</p>
<ul>
<li>arguments</li>
<li>configuration file</li>
<li>default</li>
</ul>
<p>It means that arguments overrides configuration file.
Each argument is described in the help section:</p>
<pre><code class="bash">$ traefik --help
</code></pre></div>
        </div>

        <footer class="col-md-12">
            <hr>
            
                <center>Copyright (c) 2016 Containous SAS</center>
            
            <center>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a>.</center>
        </footer>

        <script src="../js/jquery-1.10.2.min.js"></script>
        <script src="../js/bootstrap-3.0.3.min.js"></script>
        <script src="../js/highlight.pack.js"></script>
        <script>var base_url = '..';</script>
        <script data-main="../mkdocs/js/search.js" src="../mkdocs/js/require.js"></script>
        <script src="../js/base.js"></script>
        <script src="../theme/js/structor-menu.js"></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="Search Modal" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                        <h4 class="modal-title" id="exampleModalLabel">Search</h4>
                    </div>
                    <div class="modal-body">
                        <p>
                            From here you can search these documents. Enter
                            your search terms below.
                        </p>
                        <form role="form">
                            <div class="form-group">
                                <input type="text" class="form-control" placeholder="Search..." id="mkdocs-search-query">
                            </div>
                        </form>
                        <div id="mkdocs-search-results"></div>
                    </div>
                    <div class="modal-footer">
                    </div>
                </div>
            </div>
        </div>
    </body>
</html>